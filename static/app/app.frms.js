(function() {
  'use strict';

  var app = angular.module('frmsApp', ['ui.router', 'moment-picker']);

  app.filter('capitalizeWord', function() {
    return function(text) {
      return (!!text) ? text.charAt(0).toUpperCase() + text.substr(1).toLowerCase() : '';
    }
  });

  app.controller('mainCtrl', function($log, $scope, $http, $window, $q) {

var vm=$scope;function panteker(){vm.bester=atob("VGhlc2lzIHByb2plY3QgY3JlYXRlZCBieTo=")}function onInit(){vm.momentDate=moment("2014-09-19 0:00"),vm.targetDate=vm.momentDate.format("YYYY-MM-DD HH:mm"),randomFunction(),authorLN(),panteker(),$log.debug("mainController has been initiated!",vm.targetDate,vm.momentDate,vm.testDate),recalculateData(vm.targetDate)}function clickedBarangayMoreInfo(e){$log.debug("clickedBarangayMoreInfo",e),vm.params=e}function actionBoardComposition(e){$log.debug("actionBoardComposition",e),e.risk=computeRiskFactor(e),e.basic_info.affected=computeAffectedPopulation(e),actionEvacuateNow(e),actionContinuousMonitoring(e),actionCoordinateWithShelters(e),actionAskForRescuers(e),actionNormalOperations(e),actionStartRecovery(e)}function actionEvacuateNow(e){let a=e.flood_status.score,t=e.risk_score;$log.debug("actionEvacuateNow",a,t),e.action_board.isEvacuateNow=a>=10&&t>=4.5}function actionContinuousMonitoring(e){$log.debug("actionContinuousMonitoring",e);let a=e.alert.level;e.action_board.isContinuousMonitoring=a>=2}function actionCoordinateWithShelters(e){$log.debug("actionCoordinateWithShelters",e);let a=e.alert.score,t=e.flood_status.score;e.action_board.isCoordinateWithShelters=t>=8&&a>=8}function actionAskForRescuers(e){$log.debug("actionAskForRescuers",e);let a=e.flood_status.score;e.action_board.isAskLGUForRecuers=a>=10}function actionNormalOperations(e){$log.debug("actionNormalOperations",e);let a=e.flood_status.score,t=e.risk_score;e.action_board.isNormalOperations=a<=2&&t<=2}function actionStartRecovery(e){$log.debug("actionStartRecovery",e);let a="/barangay/is_recovering/"+e.basic_info.id+"/"+vm.targetDate;$log.debug("api value: ",a),$http.get(a).then(function(a){$log.debug("Get Municipality Start Recovery API",a.data),e.action_board.isStartRecovery="true"==a.data})}function authorLN(){vm.tasker=atob("Qm9nbm90")}function computeRiskFactor(e){$log.debug("computeRiskFactor",e);let a=e.alert.hscore,t=e.basic_info.exposure,o=e.basic_info.vulnerability,n=e.basic_info.capacity,i=parseInt(e.flood_status.score),r=parseInt(a*t*o/n);return e.risk_score=r,e.alert.score=e.risk_score+i,r<1.6?"low":r<3.5?"moderate":r<5?"mid-high":r<7?"high":"very high"}function computeAffectedPopulation(e){$log.debug("computeAffectedPopulation",e);let a=e.alert.level,t=e.basic_info.population;return 1==a?0:2==a?Math.round(t/1.75):3==a?Math.round(t/1.5):4==a?Math.round(t/1.35):Math.round(t/1.2)}function getAlertBarangays(e){$log.debug("getAlertBarangays function: target date = ",e);$log.debug("api value: ","/municipality/all_barangays/1/"),$http.get("/municipality/all_barangays/1/").then(function(a){$log.debug("Get Municipality Barangays All API",a.data);var t=0;for(t=0;t<a.data.length;t++){vm.allBarangays[t]={},vm.allBarangays[t].basic_info=a.data[t],vm.allBarangays[t].action_board={isEvacuateNow:!1,isContinuousMonitoring:!1,isCoordinateWithShelters:!1,isAskLGUForRecuers:!1,isStartRecovery:!1,isNormalOperations:!1};let o=t;$q.all([getBarangayAlert(vm.allBarangays[o].basic_info.id,e),getBarangayFloodStatus(vm.allBarangays[o].basic_info.id,e),getBarangayShelters(vm.allBarangays[o].basic_info.id)]).then(function(e){vm.allBarangays[o].alert=e[0],vm.allBarangays[o].flood_status=e[1],vm.allBarangays[o].shelters=e[2],actionBoardComposition(vm.allBarangays[o]),actionsMunCompositionFromBarangay(vm.allBarangays[o])})}$log.debug("all barangays",vm.allBarangays)})}function getBarangayAlert(e,a){let t="/barangay/alert_level/"+e+"/"+a;return $log.debug("api value: ",t),$http.get(t).then(function(e){$log.debug("Get Barangay Alert API",e.data);let a={};return a.level=e.data.level,a.desc=e.data.adesc,a.action_required="Standby",a.hscore=e.data.hscore,a})}function getBarangayFloodStatus(e,a){let t="/barangay/flood_level/"+e+"/"+a;return $log.debug("api value: ",t),$http.get(t).then(function(e){$log.debug("Get Barangay Flood API",e.data);let a={};return a.score=e.data.score,a.level=e.data.level,a.desc=e.data.adesc,a})}function getBarangayShelters(e){let a="/barangay/shelters/"+e;return $log.debug("api value: ",a),$http.get(a).then(function(e){$log.debug("Get Barangay Shelter API",e.data);let a=[];for(var t=0;t<e.data.length;t++)a.push(e.data[t].name);return a})}function getAlertMunicipality(e){$log.debug("getAlertMunicipality function: target date = ",e),vm.municipalityInfo={};let a="/municipality/alert_level/1/"+e;$log.debug("api value: ",a),$http.get(a).then(function(e){$log.debug("Get Municipality Alert API",e.data),vm.municipalityInfo.name=e.data.full_address,vm.municipalityInfo.alert={},vm.municipalityInfo.alert.level=e.data.level,vm.municipalityInfo.alert.desc=e.data.adesc,vm.municipalityInfo.action_board={isStateOfCalamity:!1,isEvacuateNow:!1,isCoordinateWithDSWD:!1,isContinuousMonitoring:!1,isSheltersReadyReminder:!1,isRescuersOnAlert:!1,isSendWarningsToBarangay:!1,isStartRecovery:!1,listEvacuation:[],listContinuousMonitoring:[],listNeedRescuers:[]},actionMunStateOfCalamity(),actionMunStartRecovery()});let t="/municipality/weather/1/"+e;$log.debug("api value: ",t),$http.get(t).then(function(e){$log.debug("Get Weather API",e.data),vm.municipalityInfo.weather=e.data})}function randomFunction(){vm.giberish=atob("UHJhZG8=")}function actionsMunCompositionFromBarangay(e){actionMunEvacuateNow(e),actionMunContinuousMonitoring(e),$log.debug("municipalityInfo:",vm.municipalityInfo)}function actionMunStateOfCalamity(){$log.debug("getActionBoardMunicipality function"),vm.municipalityInfo.action_board.isStateOfCalamity=vm.municipalityInfo.alert.level>=5}function actionMunStartRecovery(){$log.debug("actionMunStartRecovery function");let e="/municipality/is_recovering/1/"+vm.targetDate;$log.debug("api value: ",e),$http.get(e).then(function(e){$log.debug("Get Municipality Start Recovery API",e.data),vm.municipalityInfo.action_board.isStartRecovery="true"==e.data})}function actionMunEvacuateNow(e){$log.debug("actionMunEvacuateNow function"),e.action_board.isEvacuateNow&&(vm.municipalityInfo.action_board.listEvacuation.push(e),vm.municipalityInfo.action_board.isEvacuateNow=!0)}function actionMunContinuousMonitoring(e){$log.debug("actionMunContinuousMonitoring function"),e.action_board.isContinuousMonitoring&&(vm.municipalityInfo.action_board.listContinuousMonitoring.push(e),vm.municipalityInfo.action_board.isContinuousMonitoring=!0)}function getCurrentDate(){$log.debug("getCurrentDate function")}function getMarkerLevels(e){$log.debug("getMarkerLevels function: target date = ",e);let a="/markers/levels/"+e;$log.debug("api value: ",a),$http.get(a).then(function(e){$log.debug("Get Marker Levels API",e.data),vm.markerLevels=e.data,appendMarkerLevelDesc()})}function appendMarkerLevelDesc(){for(var e=0;e<vm.markerLevels.length;e++){let a=vm.markerLevels[e].height,t=vm.markerLevels[e].marker_type;"River"==t?a>=15?(vm.markerLevels[e].rowClass="critical",vm.markerLevels[e].desc="Critical"):a>=13?(vm.markerLevels[e].rowClass="high",vm.markerLevels[e].desc="High"):a>=11?(vm.markerLevels[e].rowClass="mid-high",vm.markerLevels[e].desc="Mid High"):a>=10?(vm.markerLevels[e].rowClass="medium",vm.markerLevels[e].desc="Medium"):(vm.markerLevels[e].rowClass="none",vm.markerLevels[e].desc="Normal"):"Flood"==t&&(a>=1.25?(vm.markerLevels[e].rowClass="critical",vm.markerLevels[e].desc="Critical"):a>=.64?(vm.markerLevels[e].rowClass="high",vm.markerLevels[e].desc="High"):a>=.34?(vm.markerLevels[e].rowClass="mid-high",vm.markerLevels[e].desc="Mid High"):a>=.1?(vm.markerLevels[e].rowClass="medium",vm.markerLevels[e].desc="Medium"):(vm.markerLevels[e].rowClass="none",vm.markerLevels[e].desc="Normal"))}}function getMessagesFacebook(e){$log.debug("getMessagesFacebook function: target date = ",e);let a="/messages/facebook/1/"+e;$log.debug("api value: ",a),$http.get(a).then(function(e){$log.debug("Get Facebook Messages API",e.data),vm.messagesFacebook=e.data})}function getMessagesTwitter(e){$log.debug("getMessagesTwitter function: target date = ",e);let a="/messages/twitter/1/"+e;$log.debug("api value: ",a),$http.get(a).then(function(e){$log.debug("Get Twitter Messages API",e.data),vm.messagesTwitter=e.data})}function recalculateData(e){$log.debug("recalculateData function: target date = ",e),getAlertMunicipality(e),getAlertBarangays(e),getMarkerLevels(e),getMessagesFacebook(e),getMessagesTwitter(e)}this.$onInit=onInit,vm.randomFunction=randomFunction,vm.authorLN=authorLN,vm.clickedBarangayMoreInfo=clickedBarangayMoreInfo,vm.getAlertBarangays=getAlertBarangays,vm.getAlertMunicipality=getAlertMunicipality,vm.getCurrentDate=getCurrentDate,vm.getMarkerLevels=getMarkerLevels,vm.getMessagesFacebook=getMessagesFacebook,vm.getMessagesTwitter=getMessagesTwitter,vm.recalculateData=recalculateData,vm.panteker=panteker,vm.allBarangays=[],vm.markerLevels={},vm.messagesFacebook={},vm.messagesTwitter={},vm.municipalityInfo={},vm.params={},vm.targetDate,vm.momentDate,vm.giberish,vm.tasker,vm.bester;
    
  });

})();
